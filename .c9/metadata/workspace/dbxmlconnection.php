{"filter":false,"title":"dbxmlconnection.php","tooltip":"/dbxmlconnection.php","undoManager":{"mark":14,"position":14,"stack":[[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"insert","lines":["<"],"id":1}],[{"start":{"row":0,"column":1},"end":{"row":0,"column":2},"action":"insert","lines":["p"],"id":2}],[{"start":{"row":0,"column":2},"end":{"row":0,"column":3},"action":"insert","lines":["h"],"id":3}],[{"start":{"row":0,"column":3},"end":{"row":0,"column":4},"action":"insert","lines":["p"],"id":4}],[{"start":{"row":0,"column":3},"end":{"row":0,"column":4},"action":"remove","lines":["p"],"id":5}],[{"start":{"row":0,"column":2},"end":{"row":0,"column":3},"action":"remove","lines":["h"],"id":6}],[{"start":{"row":0,"column":1},"end":{"row":0,"column":2},"action":"remove","lines":["p"],"id":7}],[{"start":{"row":0,"column":1},"end":{"row":0,"column":2},"action":"insert","lines":["?"],"id":8}],[{"start":{"row":0,"column":2},"end":{"row":0,"column":3},"action":"insert","lines":["p"],"id":9}],[{"start":{"row":0,"column":3},"end":{"row":0,"column":4},"action":"insert","lines":["h"],"id":10}],[{"start":{"row":0,"column":4},"end":{"row":0,"column":5},"action":"insert","lines":["p"],"id":11}],[{"start":{"row":0,"column":5},"end":{"row":0,"column":6},"action":"insert","lines":[" "],"id":12}],[{"start":{"row":0,"column":6},"end":{"row":1,"column":0},"action":"insert","lines":["",""],"id":13}],[{"start":{"row":1,"column":0},"end":{"row":1,"column":4},"action":"insert","lines":["    "],"id":14}],[{"start":{"row":0,"column":0},"end":{"row":1,"column":4},"action":"remove","lines":["<?php ","    "],"id":15},{"start":{"row":0,"column":0},"end":{"row":108,"column":2},"action":"insert","lines":["<?php","require(\"phpsqlajax_dbinfo.php\");","","// Start XML file, create parent node","$doc = domxml_new_doc(\"1.0\");","$node = $doc->create_element(\"markers\");","$parnode = $doc->append_child($node);","","// Opens a connection to a MySQL server","$connection=mysql_connect ('localhost', $username, $password);","if (!$connection) {","  die('Not connected : ' . mysql_error());","}","","// Set the active MySQL database","$db_selected = mysql_select_db($database, $connection);","if (!$db_selected) {","  die ('Can\\'t use db : ' . mysql_error());","}","","// Select all the rows in the markers table","$query = \"SELECT * FROM markers WHERE 1\";","$result = mysql_query($query);","if (!$result) {","  die('Invalid query: ' . mysql_error());","}","","header(\"Content-type: text/xml\");","","// Iterate through the rows, adding XML nodes for each","while ($row = @mysql_fetch_assoc($result)){","  // Add to XML document node","  $node = $doc->create_element(\"marker\");","  $newnode = $parnode->append_child($node);","","  $newnode->set_attribute(\"name\", $row['name']);","  $newnode->set_attribute(\"address\", $row['address']);","  $newnode->set_attribute(\"lat\", $row['lat']);","  $newnode->set_attribute(\"lng\", $row['lng']);","  $newnode->set_attribute(\"type\", $row['type']);","}","","$xmlfile = $doc->dump_mem();","echo $xmlfile;","","?>","In the file above, the PHP code first initializes a new XML document and creates the \"markers\" parent node. It then connects to the database, executes a SELECT * (select all) query on the markers table, and iterates through the results. For each row in the table (each location), the code creates a new XML node with the row attributes as XML attributes, and appends it to the parent node. The last part of code then dumps the XML to the browser screen.","","Note: If your database contains international characters or you otherwise need to force a UTF-8 output, you can use utf8_encode on the data output.","","Using PHP's echo to output XML","","If you don't have access to PHP's dom_xml functions, then you can output the XML with the echo function. Use a helper function (e.g. parseToXML) when using just the echo function to correctly encode a few special entities (<,>,\",') to be XML friendly.","","Below is the PHP file that connects to the MySQL database, and dumps the XML to the browser.","","<?php","require(\"phpsqlajax_dbinfo.php\");","","function parseToXML($htmlStr)","{","$xmlStr=str_replace('<','&lt;',$htmlStr);","$xmlStr=str_replace('>','&gt;',$xmlStr);","$xmlStr=str_replace('\"','&quot;',$xmlStr);","$xmlStr=str_replace(\"'\",'&#39;',$xmlStr);","$xmlStr=str_replace(\"&\",'&amp;',$xmlStr);","return $xmlStr;","}","","// Opens a connection to a MySQL server","$connection=mysql_connect ('localhost', $username, $password);","if (!$connection) {","  die('Not connected : ' . mysql_error());","}","","// Set the active MySQL database","$db_selected = mysql_select_db($database, $connection);","if (!$db_selected) {","  die ('Can\\'t use db : ' . mysql_error());","}","","// Select all the rows in the markers table","$query = \"SELECT * FROM markers WHERE 1\";","$result = mysql_query($query);","if (!$result) {","  die('Invalid query: ' . mysql_error());","}","","header(\"Content-type: text/xml\");","","// Start XML file, echo parent node","echo '<markers>';","","// Iterate through the rows, printing XML nodes for each","while ($row = @mysql_fetch_assoc($result)){","  // Add to XML document node","  echo '<marker ';","  echo 'name=\"' . parseToXML($row['name']) . '\" ';","  echo 'address=\"' . parseToXML($row['address']) . '\" ';","  echo 'lat=\"' . $row['lat'] . '\" ';","  echo 'lng=\"' . $row['lng'] . '\" ';","  echo 'type=\"' . $row['type'] . '\" ';","  echo '/>';","}","","// End XML file","echo '</markers>';","","?>"]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":108,"column":2},"end":{"row":108,"column":2},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1487263571073,"hash":"ea48fd7e4d73d29df1822f560dbf9430fdeccb6b"}